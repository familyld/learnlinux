# 如何使用腾讯云的云服务器

一般来说，大家主机装的都是Windows系统，要学习Linux知识时需要使用到Linux系统的主机，这时要怎么办呢？

有三种方法，

1. 安装虚拟机软件，比方说Virtual Box和VMware；
2. 购买装有Linux系统的微型主机，比方说Raspberry Pi；
3. 对于前两种方式都不想做的懒人来说，还有第三种方式，就是购买云服务器了。

云服务器其实也是一台主机，但是这台主机托管在云服务商那里的，我们既不需要为硬件上的配置费心，也不需要花大价钱购买一台真实的主机。只需要选择好硬件，网络，操作系统等配置，再根据配置向云服务商付相应的费用就可以了。一般来说，有pay-per-use（用多少算多少）的计费方式，也有选定好配置按配置付钱的计费方式。笔者购置的是腾讯云提供的云服务器，装载Ubuntu Server 14.04.1 LTS 64位操作系统，这里简单地记录一下使用的流程。

## 购买

虽说使用云服务器不用买一台真的主机回来，但动动手选一下配置还是需要的。[官方文档](https://www.qcloud.com/doc/product/213/2972)已经讲得比较清楚了，这里简单说说值得注意的地方法。

注册完腾讯云帐号后，登录官网，选择产品中的云服务器：

![官网](https://raw.githubusercontent.com/familyld/learnlinux/master/graph/OfficialWebsite.png)

然后进入选购页面，在这里可以根据我们的需求选择合适的云服务器。

![选择配置](https://mccdn.qcloud.com/static/img/0a506ce5c9c271ee09ea237ce1d34944/image.png)

计费方式的区别前面已经提到了，可以根据实际需求来衡量。举个例子，双十一那一周网站的访客量和点击量会大大增加，峰值相比起其他时段要高出许多，也因此需要更大的计算量，但是仅仅因为这一周而购买包年包月的云服务器是及其浪费的，所以就有了按量计费的需求。仅在需要用到的时候购入，用完了就结算，非常方便。

然后还可以选择云服务器所处的地域，也就是说放置这台主机的地点，一般来说对带宽需求比较大，要尽量避免延迟的话可以就近选择。而从容灾的角度来看，当使用多台云服务器时，最好选择不同的可用区，这样即使一个可用区遇到突发情况down掉了，也还可以用其他处于可用区的主机顶替。

机型和配置因为这里只是做普通的实验，所以选的是配置最低的标准型。介绍如下：

- 标准型：覆盖低核到大核，适合中小型Web或数据库业务
- 高IO型：系统盘数据盘均为高性能SSD盘，适合低时延和IO密集型应用
- 内存型：CPU内存比为1：8，适合大规模内存操作、查找和计算

具体对比可以参考[这里](http://www.qcloud.com/doc/product/213/CVM%E5%AE%9E%E4%BE%8B#3.-机型)。

接下来就到选择镜像了：

![镜像](https://mccdn.qcloud.com/static/img/fe36402379bbc70d9e17591568a6e1f6/image.png)

原始的镜像都由服务商提供好，我们只要选择就可以了，省去了许多麻烦。这里笔者选择了Ubuntu 14.04，因为Ubuntu的社区氛围比较好，使用过程中如果有问题，在网上基本上都能查到。

再然后是存储和网络：

![存储](https://mccdn.qcloud.com/static/img/ef73fc3a1b4d6d1579b322d92d536ac1/image.png)

![网络](https://mccdn.qcloud.com/static/img/3a09b6af11caeb074282dd23006dd818/image.png)

这里没有太多好说的，后面还有服务器数量，购买时长，还是根据需求来选择即可。

关于登录方式：

- 密码登录：系统自动生成初始密码并通过站内信发送给您。获取初始密码后即可通过默认用户名及密码登录Linux云服务器。
- 密钥登录：安全性高于普通密码登录，要求您先创建一对密钥。

如果对隐私要求比较高，可以采用密钥登录，涉及到相关的协议，需要进行一些额外配置。笔者采用的是最普通的密码登录方式。

关于安全组，由于使用的是Linux，所以安全组选择的是Linux安全组，开放22端口。如果没有选择开放22端口，则后续使用远程登录时是没办法连接上的，会出现``"Network error:Connection timed out"``的问题。

## 登录

购买完成后，可以在管理界面可以这台主机的信息：

![管理界面](https://mccdn.qcloud.com/img56b1a6cb7b3e8.png)

除了基本信息之外，可以看到右侧红圈内的登录，点击后会弹出一个窗口，通过VNC自动连接到该主机，我们可以直接在弹出窗口中直接使用。

> 注：该终端为独享，即同一时间只有一个用户可以使用控制台登录。

但是如果我们想在本地用远程登录软件登录主机，应该怎么办呢？

首先准备好远程登录软件，最常用的有[Putty](http://www.putty.nl/download.html)，可以在链接页面中下载。界面如下：

![putty](https://mccdn.qcloud.com/img56a5d38a4ffbc.png)

这里我们有三个地方是要注意的，一是Host Name，主机名就是公网IP；二是Port，端口是22，前面设置安全组时打开即可。三是连接类型，这里选择SSH协议。为了下次不用重复设置，我们可以把这些设置保存为一个会话，在Saved Sessions下面的空白框输入会话名（随意设一个名字就可以了），然后点击Save按钮保存。下次要登录云主机时，选中这个会话，点击Load按钮，设置信息就会自动填写好了。完成后点击Open按钮进行连接：

![登录](https://raw.githubusercontent.com/familyld/learnlinux/master/graph/login.png)

弹出的控制台要求我们输入用户名和密码登录，这些信息都在我们购买后收到的站内信里面：

![站内信](https://mccdn.qcloud.com/img56a20f10a373a.png)

Ubuntu系统的用户名就是ubuntu，初始密码就是站内信中给出的web客户端登录密码。Linux下输入的密码是不会显示出来的，输入完直接按回车就可以了。

顺利的话，到这里就成功登录，可以开始使用了。

但是，笔者在实际使用时遇到了一个问题，在输入用户名回车后，Putty提示``"Disconnected:No supported authentication methods available"``，也就是说无法通过密码登录。可能是笔者前面摆弄的时候玩脱了.. 查了一下，要解决这个问题也相当简单，我们需要修改主机的sshd_config文件，令其支持密码验证功能。

回到管理界面，通过网页端登录并进入到云服务器内，使用``sudo vi /etc/ssh/sshd_config``语句打开配置文件。

在vi下通过``:e``进入编辑模式，找到``PasswordAuthentication no``这一行，把no改为yes。然后按Esc回到命令模式，使用``:wq``保存文件并退出。注意前面打开文件时一定要使用sudo，否则会因为没有修改文件的权限而无法保存。

完成后重启云服务器，然后再次尝试远程登录，这次终于成功了：

![成功](https://raw.githubusercontent.com/familyld/learnlinux/master/graph/finish.png)

然后我们还需要修改一下初始密码，在Ubuntu下可以利用``passwd``命令修改密码，不带参数的话就是直接修改根用户密码，回车后先输入初始密码，然后根据提示输入两次新密码就修改完成了。这样下一次登录时需要使用的就是新密码了。

如果购买了数据盘，还需要进行格式化才能使用，详见[官方教程](https://www.qcloud.com/doc/product/213/2974)。

接下来可以按照自己需要配置工作环境，比方说配置ftp，配置git，配置nginx等等，同样参见[官方教程](https://www.qcloud.com/doc/product/213/2975)。

镜像自带有gcc 4.8.4，python 2.7.6和python3.4.0，还有编辑器vim，已经完全符合符合笔者需要的工作环境。当然，要让vim更好用更方便还需要额外进行一些配置，这都是后话了。如果不确定编译环境是否有安装好，可以先用``gcc -v``之类的查看版本的语句看看，然后用``sudo apt-get install build-essential``语句或者特定的安装语句安装必要的编译环境。

在命令行下工作，没有图形界面可以多少有些不习惯，不过笔者暂时没有弄界面的打算，正好多熟悉一下Linux命令行使用。要创建目录可以用``mkdir 文件夹名``，然后利用vim来创建/编辑/保存文件，需要编译c/c++时，用``g++ 源文件.cpp -o 可执行文件名``命令编译，然后用``./可执行文件名``执行。多个文件的话可以先编写Makefile文件，注意和代码文件放在同一文件夹，然后在此目录下使用make统一编译就可以了。
